<!DOCTYPE html>
<html>
<head>
  <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
  <title>handler</title>
</head>
<body>
%%[
    
    SET @origin = HTTPRequestHeader("Referer")
    set @url= CloudPagesURL(7786)  
    /*   */
    SET @pattern =Concat("^",Substring(@url,1, Subtract(IndexOf(@url,"?"),1)),".*")
    SET @match = RegExMatch(@origin, @pattern, 0)

]%%
<script>
console.log("%%=v(@origin)=%%")
console.log("%%=v(@pattern)=%%")
console.log("%%=v(@match)=%%")
</script>
<script runat="server">
    Platform.Load("core","1");
    var MATCH = Variable.GetValue("@match");
    if (!MATCH) { MATCH = null }
    HTTPHeader.SetValue("Access-Control-Allow-Methods","POST");
    /* HTTPHeader.SetValue("Access-Control-Allow-Origin",MATCH); */
   Platform.Response.SetResponseHeader("Strict-Transport-Security","max-age=200");
   Platform.Response.SetResponseHeader("X-XSS-Protection","1; mode=block");
   Platform.Response.SetResponseHeader("X-Frame-Options","Deny");
   Platform.Response.SetResponseHeader("X-Content-Type-Options","nosniff");
   Platform.Response.SetResponseHeader("Referrer-Policy","strict-origin-when-cross-origin");
   Platform.Response.SetResponseHeader("Content-Security-Policy","default-src 'self'");
</script>

%%[



IF LENGTH(@match) > 0 THEN  

   
set @firstName=Field(@subscriberRow, "first name", 0) 
set @lastName=Field(@subscriberRow, "last name", 0) 
set @email=RequestParameter("email")

set @prefcenterRow=Row(@prefcenterRows,1)
set @hasOptedOut=Field(@prefcenterRow, "hasOptedOut", 0) 
set @newsletter=Field(@prefcenterRow, "newsletter", 0) 
set @events=Field(@prefcenterRow, "events", 0) 
set @offers=Field(@prefcenterRow, "offers", 0) 

 


    IF NOT EMPTY(@email) THEN
        /* Redirect(CONCAT(CloudPagesURL(7786,'Success',1))) */
    ENDIF

ENDIF

]%%

</body>
</html>